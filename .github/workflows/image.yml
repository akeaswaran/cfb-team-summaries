name: Build and Push Docker Image

on:
  push:
    branches:
        - main
  schedule:
    - cron: "0 0 * * 1"
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions: 
      actions: write
    steps:
#       - name: Checkout Code
#         uses: actions/checkout@v1
#       - name: Build and Push Docker Image
#         uses:  mr-smithers-excellent/docker-build-push@v5.5
#         with:
#           image: ${{ github.repository }}
#           registry: ghcr.io
#           username: ${{ github.actor }}
#           password: ${{ secrets.GITHUB_TOKEN }}
#           tags: latest
      - name: Redeploy GameOnPaper
        env: 
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          curl \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            https://api.github.com/repos/saiemgilani/game-on-paper-app/actions/workflows/deploy.yml/dispatches \
            -d '{"ref":"main"}'
